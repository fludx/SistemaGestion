CREATE OR ALTER PROCEDURE dbo.sp_VerificarPuntoReposicion
AS
BEGIN
    SET NOCOUNT ON;
    SELECT p.id_producto, p.codigo, p.nombre, p.punto_reposicion, SUM(COALESCE(s.cantidad,0)) AS stock_total
    FROM Productos p
    LEFT JOIN Stock_Productos s ON p.id_producto = s.id_producto
    GROUP BY p.id_producto, p.codigo, p.nombre, p.punto_reposicion
    HAVING SUM(COALESCE(s.cantidad,0)) <= p.punto_reposicion;
END
GO