CREATE OR ALTER PROCEDURE dbo.sp_ReporteStockGeneral
AS
BEGIN
    SET NOCOUNT ON;
    SELECT p.id_producto, p.codigo, p.nombre, SUM(COALESCE(s.cantidad,0)) AS stock_total,
           p.stock_minimo, p.punto_reposicion
    FROM Productos p
    LEFT JOIN Stock_Productos s ON p.id_producto = s.id_producto
    GROUP BY p.id_producto, p.codigo, p.nombre, p.stock_minimo, p.punto_reposicion;
END
GO